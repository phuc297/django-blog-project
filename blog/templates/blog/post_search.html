{% extends 'base/base.html' %}
{% load static %}

{% block title %}
  Django Blog
{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/post_list.css' %}" />
{% endblock %}

{% block content %}
  <div class="w-2/5 mx-auto">
    <h1 class="font-bold text-3xl md:text-4xl text-center pt-4 pb-2">Kết quả tìm kiếm cho <span class="text-green-500 italic">"{{ searchQuery }}"</span></h1>

    <div class="text-center mt-4">
      <button id="toggleAccordionBtn" class="bg-green-500 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg transition">Hiện bộ lọc</button>
    </div>

    <div id="accordion" class="hidden flex flex-col items-left mt-2 space-y-4">
      <!-- Lọc -->
      <div id="divFilter">
        <label class="flex font-medium text-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 
                    01-.293.707L12 12.414V16a1 1 0 01-1.447.894l-2-1A1 
                    1 0 018 15v-2.586L3.293 6.707A1 1 0 013 6V4z" clip-rule="evenodd" />
          </svg>Lọc theo:
        </label>
        <hr class="mb-3 mt-1" />
        <div id="divCategory" class="flex flex-wrap gap-2">
          <label class="font-semibold text-sm ml-1">Loại:</label>
          <a href="?category=all{% if request.GET.searchQuery %}
              
              
              
              
              
              
              
              &searchQuery={{ request.GET.searchQuery }}
            {% endif %}{% if request.GET.sort %}
              
              
              
              
              
              
              
              &sort={{ request.GET.sort }}
            {% endif %}{% if request.GET.tag %}
              
              
              
              
              
              
              
              &tag={{ request.GET.tag }}
            {% endif %}"
            class="px-5 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium cursor-pointer 
                    {% if selected_category == 'all' %}
              
              
              
              
              
              
              
              
                      bg-green-600 text-white








            {% else %}
              
              
              
              
              
              
              
              
                      bg-gray-200 hover:bg-gray-300








            {% endif %}">
            Tất cả
          </a>
          {% for cat in categories %}
            <a href="?category={{ cat.name }}{% if request.GET.searchQuery %}
                
                
                
                
                
                
                
                &searchQuery={{ request.GET.searchQuery }}
              {% endif %}{% if request.GET.sort %}
                
                
                
                
                
                
                
                &sort={{ request.GET.sort }}
              {% endif %}{% if request.GET.tag %}
                
                
                
                
                
                
                
                &tag={{ request.GET.tag }}
              {% endif %}"
              class="px-5 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium cursor-pointer 
                      {% if cat.name == selected_category %}
                
                
                
                
                
                
                
                
                        bg-green-600 text-white








              {% else %}
                
                
                
                
                
                
                
                
                        bg-gray-200 hover:bg-gray-300



              {% endif %}">
              {{ cat.name }}
            </a>
          {% endfor %}
        </div>
        <hr class="ml-4 mr-4 mt-2 mb-3 border-gray-400" />
        <div id="divTag" class="flex flex-wrap gap-2">
          <label class="font-semibold text-sm ml-1">Thẻ:</label>
          <a href="?tag=all{% if request.GET.searchQuery %}
              
              
              
              
              
              
              
              &searchQuery={{ request.GET.searchQuery }}
            {% endif %}{% if request.GET.sort %}
              
              
              
              
              
              
              
              &sort={{ request.GET.sort }}
            {% endif %}{% if request.GET.category %}
              
              
              
              
              
              
              
              &category={{ request.GET.category }}
            {% endif %}"
            class="px-3 py-1 rounded-full text-sm cursor-pointer {% if selected_tag == 'all' %}
              
              
              
              
              
              
                bg-blue-600 text-white






            {% else %}
              
              
              
              
              
              
               bg-gray-200 hover:bg-gray-300






            {% endif %}">
            Tất cả
          </a>
          {% for tag in tags %}
            <a href="?tag={{ tag.name }}{% if request.GET.searchQuery %}
                
                
                
                
                
                
                
                &searchQuery={{ request.GET.searchQuery }}
              {% endif %}{% if request.GET.sort %}
                
                
                
                
                
                
                
                &sort={{ request.GET.sort }}
              {% endif %}{% if request.GET.category %}
                
                
                
                
                
                
                
                &category={{ request.GET.category }}
              {% endif %}"
              class="px-3 py-1 rounded-full text-sm cursor-pointer {% if tag.name == selected_tag %}
                
                
                
                
                
                
                 bg-blue-600 text-white






              {% else %}
                
                
                
                
                
                
                bg-gray-200 hover:bg-gray-300






              {% endif %}">
              {{ tag.name }}
            </a>
          {% endfor %}
        </div>
      </div>
    </div>

    {% if page_obj.object_list %}
      {% for post in page_obj %}
        <article class="flex flex-1 bg-white rounded-lg border border-gray-300 p-8 my-6">
          <div class="flex flex-col justify-between mx-4 flex-1">
            <a href="{% url 'blog:detail' post.id %}">
              <h4 class="text-gray-600 font-semibold"><time datetime="{{ post.created_at|date:'c' }}"><span>{{ post.created_at|date:'F j, Y' }}</span></time></h4>
              <h3 class="text-2xl font-semibold text-gray-800 hover:text-green-500">{{ post.title }}</h3>
            </a>
            <p class="text-gray-600">{{ post.description }}...</p>

            <div class="flex justify-between items-center mt-2">
              <a href="{% url 'users:profile' post.author.profile.id %}" class="flex items-center">
                <img src="{{ post.author.profile.avatar.url }}" alt="Avatar" class="h-12 w-12 rounded-full" />
                <span class="font-medium hover:underline">{{ post.author }}</span>
              </a>
            </div>

            <div class="font-semibold text-sm text-gray-600 m-2 flex items-start gap-x-6">
              <a href="" class="p-1">
                <span class="flex items-center space-x-1">
                  <svg aria-hidden="true" class="svg-icon iconMessage va-middle mr4 mtn2" width="18" height="18" viewBox="0 0 18 18">
                    <path d="M1 4v14l3-3h11c1.09 0 2-.91 2-2V4c0-1.09-.91-2-2-2H3a2 2 0 0 0-2 2m3 9-1 1V4h12v9zm1-6a1 1 0 0 1 1-1h6a1 1 0 1 1 0 2H6a1 1 0 0 1-1-1m1 2a1 1 0 1 0 0 2h4a1 1 0 1 0 0-2z"></path>
                  </svg>

                  <span>{{ post.comments.all.count }}</span>
                  <span>comment</span>
                </span>
              </a>
              <div class="w-2/3 flex flex-wrap gap-1">
                {% for tag in post.tags.all %}
                  <a href="" class="border border-green-300 text-green-400 hover:bg-green-100 rounded p-1"><span>{{ tag }}</span></a>
                {% endfor %}
              </div>
            </div>
          </div>
          <a href="{% url 'blog:detail' post.id %}" class="mx-2"><img src="{{ post.thumbnail.url }}" alt="Thumbnail" class="hidden lg:block w-64 h-36 object-cover rounded-lg" /></a>
        </article>
      {% endfor %}

      <!-- Pagination controls -->
      <div class="pagination mt-4 flex justify-center items-center space-x-4 mt-6">
        {% if page_obj.has_previous %}
          <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.searchQuery %}
              
              
              
              
              
              
              
              &searchQuery={{ searchQuery }}
            {% endif %}">
            ↩ Trước
          </a>
        {% endif %}

        <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-base font-semibold shadow">Trang {{ page_obj.number }} trên {{ page_obj.paginator.num_pages }}</span>

        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}{% if request.GET.searchQuery %}
              
              
              
              
              
              
              
              &searchQuery={{ searchQuery }}
            {% endif %}">
            Sau ↪
          </a>
        {% endif %}
      </div>
    {% else %}
      <p class="text-center text-gray-500 mt-6">Không tìm thấy bài viết nào.</p>
    {% endif %}
  </div>
{% endblock %}

{% block script %}
  <script src="{% static 'blog/js/post_search.js' %}"></script>
{% endblock %}
