{% extends 'base/base.html' %}
{% load static content_filters %}

{% block title %}
  Django Blog
{% endblock %}

{% block content %}
  <div class="relative max-w-6xl max-h-120 mx-auto my-10 overflow-hidden rounded-lg shadow-lg">
    <!-- Các slide -->
    <div class="slides flex transition-transform duration-700 ease-in-out">
      <img src="{% static 'default-image.webp' %}" class="w-full flex-shrink-0" />
      <img src="{% static 'default-image.webp' %}" class="w-full flex-shrink-0" />
      <img src="{% static 'default-image.webp' %}" class="w-full flex-shrink-0" />
    </div>

    <!-- Nút điều hướng -->
    <button id="prevBtn" class="absolute left-3 top-1/2 -translate-y-1/2 bg-gray-400 bg-opacity-25 text-white px-3 py-2 rounded-lg">‹</button>
    <button id="nextBtn" class="absolute right-3 top-1/2 -translate-y-1/2 bg-gray-400 bg-opacity-25 text-white px-3 py-2 rounded-lg">›</button>
  </div>

  <div class="flex justify-center">
    <div id="left-bar" class="w-1/5">
      <h3 class="font-semibold text-lg mb-3 px-4">Danh mục</h3>
      <div class="space-y-2 px-8">
        {% for cat in top_categories %}
          <div>
            <a href="#" class="text-gray-700 text-xl">{{ cat.name }}</a>
          </div>
        {% endfor %}
      </div>

      <hr class="my-4 text-gray-300" />

      <h3 class="font-semibold text-lg mb-3 px-4">Tag phổ biến</h3>
      <div class="flex flex-wrap gap-2 px-8">
        {% for tag in top_tags|slice:':10' %}
          <a href="#" class="bg-green-100 text-green-600 text-sm px-2 py-1 rounded hover:bg-green-200">#{{ tag.name }}</a>
        {% endfor %}
      </div>
    </div>

    <div id="post-list" class="w-2/5 h-full mx-10">
      <h3 class="font-semibold text-lg mb-3 px-4">Bài viết mới nhất</h3>
      {% if page_obj.object_list %}
        {% for post in page_obj %}
          <article class="flex flex-1 bg-white rounded-lg border border-gray-300 p-8 my-6">
            <div class="flex flex-col justify-between mx-4 flex-1">
              <a href="{% url 'blog:detail' post.id %}">
                <h4 class="text-gray-600 font-semibold"><time datetime="{{ post.created_at|date:'c' }}"><span>{{ post.created_at|date:'F j, Y' }}</span></time></h4>
                <h3 class="text-2xl font-semibold text-gray-800 hover:text-green-500">{{ post.title }}</h3>
              </a>
              <p class="text-gray-600">{{ post.description }}...</p>

              <div class="flex justify-between items-center mt-2">
                <a href="{% url 'users:profile' post.author.profile.id %}" class="flex items-center">
                  <img src="{{ post.author.profile.avatar.url }}" alt="Avatar" class="h-12 w-12 rounded-full" />
                  <span class="font-medium hover:underline">{{ post.author }}</span>
                </a>
              </div>

              <div class="font-semibold text-sm text-gray-600 m-2 flex items-start gap-x-6">
                <a href="" class="p-1">
                  <span class="flex items-center space-x-1">
                    <svg aria-hidden="true" class="svg-icon iconMessage va-middle mr4 mtn2" width="18" height="18" viewBox="0 0 18 18">
                      <path d="M1 4v14l3-3h11c1.09 0 2-.91 2-2V4c0-1.09-.91-2-2-2H3a2 2 0 0 0-2 2m3 9-1 1V4h12v9zm1-6a1 1 0 0 1 1-1h6a1 1 0 1 1 0 2H6a1 1 0 0 1-1-1m1 2a1 1 0 1 0 0 2h4a1 1 0 1 0 0-2z"></path>
                    </svg>

                    <span>{{ post.comments.all.count }}</span>
                    <span>comment</span>
                  </span>
                </a>
                <div class="w-2/3 flex flex-wrap gap-1">
                  {% for tag in post.tags.all %}
                    <a href="" class="border border-green-300 text-green-400 hover:bg-green-100 rounded p-1"><span>{{ tag }}</span></a>
                  {% endfor %}
                </div>
              </div>
            </div>
            <a href="{% url 'blog:detail' post.id %}" class="mx-2"><img src="{{ post.thumbnail.url }}" alt="Thumbnail" class="hidden lg:block w-64 h-36 object-cover rounded-lg" /></a>
          </article>
        {% endfor %}

        <!-- Pagination controls -->
        <div class="pagination mt-4 flex justify-center items-center space-x-4 mt-6">
          {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.searchQuery %}
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
              
              
              
              
              
              &searchQuery={{ searchQuery }}
              {% endif %}">
              ↩ Trước
            </a>
          {% endif %}

          <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-base font-semibold shadow">Trang {{ page_obj.number }} trên {{ page_obj.paginator.num_pages }}</span>

          {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if request.GET.searchQuery %}
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
              
              
              
              
              
              &searchQuery={{ searchQuery }}
              {% endif %}">
              Sau ↪
            </a>
          {% endif %}
        </div>
      {% else %}
        <p class="text-center text-gray-500 mt-6">Không tìm thấy bài viết nào.</p>
      {% endif %}
    </div>

    <div id="right-bar" class="w-1/5">
      <h3 class="font-semibold text-lg mb-3 px-4">Bài viết nổi bật</h3>

      {% for post in top_posts %}
        <div class="rounded-lg border border-gray-300 p-8 my-6">
          <a href="{% url 'blog:detail' post.id %}">
            <h3 class="text-xl font-semibold">{{ post.title }}</h3>
            <p>{{ post.description|truncate_words:10 }}</p>
          </a>
        </div>
      {% endfor %}


      <h3 class="font-semibold text-lg mb-3 px-4">Người dùng nổi bật</h3>

      <div class="flex flex-col rounded-lg border border-gray-300 p-8 my-6">
        {% for author in top_authors %}
          <div class="w-2/3 flex py-3 font-sans">
            <a href="{% url 'users:profile' author.profile.id %}" class="flex-shrink-0"><img src="{{ author.profile.avatar.url }}" alt="Avatar" class="w-12 h-12 rounded-full" /></a>
            <div class="px-3">
              <a href="{% url 'users:profile' author.profile.id %}" class="font-medium hover:underline">{{ author }}</a>
              <p class="text-xs text-gray-500">{{ author.profile.bio|truncate_words:8 }}</p>
            </div>
          </div>
        {% endfor %}
      </div>

    
    </div>
  </div>
{% endblock %}

{% block script %}
  <script>
    const slides = document.querySelector('.slides')
    const totalSlides = slides.children.length
    let index = 0
    
    document.getElementById('nextBtn').addEventListener('click', () => {
      index = (index + 1) % totalSlides
      updateSlide()
    })
    
    document.getElementById('prevBtn').addEventListener('click', () => {
      index = (index - 1 + totalSlides) % totalSlides
      updateSlide()
    })
    
    function updateSlide() {
      slides.style.transform = `translateX(-${index * 100}%)`
    }
  </script>
{% endblock %}
